var bootstrap = function ($, learun) { "use strict"; var meuns = { init: function () { this.load(); this.bind() }, load: function () { var modulesTree = learun.clientdata.get(['modulesTree']); var parentId = '0'; var modules = modulesTree[parentId] || []; var $firstmenus = $('<ul class="sp-first-menu-list"></ul>'); for (var i = 0, l = modules.length; i < l; i++) { var item = modules[i]; if (item.F_IsMenu == 1) { var $firstMenuItem = $('<li></li>'); if (!!item.F_Description) { $firstMenuItem.attr('title', item.F_Description) }; var menuItemHtml = '<a id="' + item.F_ModuleId + '" href="javascript:void(0);" class="sp-menu-item">'; menuItemHtml += '<i class="' + item.F_Icon + ' sp-menu-item-icon"></i>'; menuItemHtml += '<span class="sp-menu-item-text">' + item.F_FullName + '</span>'; menuItemHtml += '</a>'; $firstMenuItem.append(menuItemHtml); var secondModules = modulesTree[item.F_ModuleId] || []; var $secondMenus = $('<ul class="sp-second-menu-list"></ul>'); var secondMenuHad = false; for (var j = 0, sl = secondModules.length; j < sl; j++) { var secondItem = secondModules[j]; if (secondItem.F_IsMenu == 1) { secondMenuHad = true; var $secondMenuItem = $('<li></li>'); if (!!secondItem.F_Description) { $secondMenuItem.attr('title', secondItem.F_Description) }; var secondItemHtml = '<a id="' + secondItem.F_ModuleId + '" href="javascript:void(0);" class="sp-menu-item" >'; secondItemHtml += '<i class="' + secondItem.F_Icon + ' sp-menu-item-icon"></i>'; secondItemHtml += '<span class="sp-menu-item-text">' + secondItem.F_FullName + '</span>'; secondItemHtml += '</a>'; $secondMenuItem.append(secondItemHtml); var threeModules = modulesTree[secondItem.F_ModuleId] || []; var $threeMenus = $('<ul class="sp-three-menu-list"></ul>'); var threeMenuHad = false; for (var m = 0, tl = threeModules.length; m < tl; m++) { var threeItem = threeModules[m]; if (threeItem.F_IsMenu == 1) { threeMenuHad = true; var $threeMenuItem = $('<li></li>'); $threeMenuItem.attr('title', threeItem.F_FullName); var threeItemHtml = '<a id="' + threeItem.F_ModuleId + '" href="javascript:void(0);" class="sp-menu-item" >'; threeItemHtml += '<i class="' + threeItem.F_Icon + ' sp-menu-item-icon"></i>'; threeItemHtml += '<span class="sp-menu-item-text">' + threeItem.F_FullName + '</span>'; threeItemHtml += '</a>'; $threeMenuItem.append(threeItemHtml); $threeMenus.append($threeMenuItem) } }; if (threeMenuHad) { $secondMenuItem.addClass('sp-meun-had'); $secondMenuItem.find('a').append('<span class="sp-menu-item-arrow"><i class="fa fa-angle-left"></i></span>'); $secondMenuItem.append($threeMenus); $threeMenus.css('display', 'none') }; $secondMenus.append($secondMenuItem) } } if (secondMenuHad) { $secondMenus.attr('data-value', item.F_ModuleId); $('#sp_second_menu_wrap').append($secondMenus) }; $firstmenus.append($firstMenuItem) } }; $('#sp_frame_menu').html($firstmenus) }, bind: function () { $("#sp_frame_menu").spscroll(); $("#sp_second_menu_wrap").spscroll(); var w = 0; var width = $('.sp-first-menu-list').children('li').each(function () { w += $(this).outerWidth() }); $('.sp-first-menu-list').css({ 'width': w + 60 }); $('.sp-first-menu-list').parent().css({ 'width': w + 60 }); $('#sp_frame_menu .sp-menu-item').on('click', function () { var $obj = $(this); var id = $obj.attr('id'); var _module = learun.clientdata.get(['modulesMap', id]); switch (_module.F_Target) { case 'iframe': if (learun.validator.isNotNull(_module.F_UrlAddress).code) { learun.frameTab.open(_module) } else { } break; case 'expand': if (!$obj.hasClass('active')) { $('#sp_frame_menu .active').removeClass('active'); $obj.addClass('active'); $obj.parent().addClass('active'); var $subMenu = $('#sp_second_menu_wrap'); $subMenu.find('.sp-second-menu-list').hide(); $subMenu.find('.sp-second-menu-list[data-value="' + id + '"]').show() } break } }); $('#sp_second_menu_wrap .sp-menu-item').on('click', function () { var $obj = $(this); var id = $obj.attr('id'); var _module = learun.clientdata.get(['modulesMap', id]); switch (_module.F_Target) { case 'iframe': if (learun.validator.isNotNull(_module.F_UrlAddress).code) { learun.frameTab.open(_module) } else { } break; case 'open': top.open(_module.F_UrlAddress); break; case 'expand': var $ul = $obj.next(); $ul.stop(false, true).slideToggle(150); $obj.toggleClass('open'); break } }); $('.sp-first-menu-list>li').eq(0).find('a').trigger('click'); $('#sp_frame_menu_btn').on('click', function () { var $body = $('body'); if ($body.hasClass('sp-menu-closed')) { $body.removeClass('sp-menu-closed') } else { $body.addClass('sp-menu-closed') } }); $('#sp_second_menu_wrap a').hover(function () { if ($('body').hasClass('sp-menu-closed')) { var id = $(this).attr('id'); var text = $('#' + id + '>span').text(); layer.tips(text, $(this)) } }, function () { if ($('body').hasClass('sp-menu-closed')) { layer.closeAll('tips') } }) } }; meuns.init(); var companyMap = {}; var departmentMap = {}; var userMap = {}; var imUserId = ''; var getHeadImg = function (user) { var url = top.$.rootUrl; switch (user.img) { case '0': url += '/Content/images/head/on-girl.jpg'; break; case '1': url += '/Content/images/head/on-boy.jpg'; break; default: url += '/LR_OrganizationModule/User/GetImg?userId=' + user.id; break }return url } };