(function ($, sp) { "use strict"; $.extend(sp, { layerConfirm: function (_msg, callback, caption) { top.sp.language.get(_msg, function (msg) { top.layer.confirm(msg, { btn: ['确认', '取消'], title: caption || " ", icon: 0, skin: 'sp-layer', success: function (layero, index) { layero.find('.layui-layer-btn a').each(function () { var $this = $(this); var _text = $this.text(); top.sp.language.get(_text, function (text) { $this.text(text) }) }); layero.find('.layui-layer-title').each(function () { var $this = $(this); var _text = $this.text(); top.sp.language.get(_text, function (text) { $this.text(text) }) }) }, }, function (index) { top.layer.close(index); callback(true, index) }, function (index) { callback(false, index); top.layer.close(index) }) }) }, layerForm: function (op) { var dfop = { id: null, title: '系统窗口', width: 550, height: 400, url: 'error', btn: ['确认', '关闭'], callBack: false, maxmin: false, end: false }; $.extend(dfop, op || {}); dfop.width = dfop.width > $(window).width() ? $(window).width() - 10 : dfop.width; dfop.height = dfop.height > $(window).height() ? $(window).height() - 10 : dfop.height; var r = top.layer.open({ id: dfop.id, maxmin: dfop.maxmin, type: 2, title: dfop.title, area: [dfop.width + 'px', dfop.height + 'px'], btn: dfop.btn, content: op.url, skin: dfop.btn == null ? 'sp-layer-nobtn' : 'sp-layer', success: function (layero, index) { top['layer_' + dfop.id] = sp.iframe($(layero).find('iframe').attr('id'), top.frames); layero[0].sp_layerid = 'layer_' + dfop.id; if (!!dfop.btn && layero.find('.sp-layer-btn-cb').length == 0) { top.sp.language.get('确认关闭窗口', function (text) { layero.find('.layui-layer-btn').append('<div class="checkbox sp-layer-btn-cb" myIframeId="layer_' + dfop.id + '" ><label><input checked="checked" type="checkbox" >' + text + '</label></div>') }); layero.find('.layui-layer-btn a').each(function () { var $this = $(this); var _text = $this.text(); top.sp.language.get(_text, function (text) { $this.text(text) }) }) } layero.find('.layui-layer-title').each(function () { var $this = $(this); var _text = $this.text(); top.sp.language.get(_text, function (text) { $this.text(text) }) }); if (dfop["success"]) { dfop["success"](layero, index) } }, yes: function (index) { var flag = true; if (!!dfop.callBack) { flag = dfop.callBack('layer_' + dfop.id) } if (!!flag) { sp.layerClose('', index) } }, end: function () { top['layer_' + dfop.id] = null; if (!!dfop.end) { dfop.end() } } }) }, layerClose: function (name, index) { var _index; if (!!index) { _index = index } else { _index = top.layer.getFrameIndex(name) } var layero = top.$("#layui-layer" + _index); var $IsClose = layero.find('.layui-layer-btn').find(".sp-layer-btn-cb input"); var IsClose = $IsClose.is(":checked"); if ($IsClose.length == 0) { IsClose = true } if (IsClose) { top.layer.close(_index) } else { top[layero[0].sp_layerid].location.reload() } } }) })(window.jQuery, top.sp);
